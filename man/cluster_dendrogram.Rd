% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/cluster_dendrogram.R
\name{cluster_dendrogram}
\alias{cluster_dendrogram}
\title{Cluster Dendrogram Leaves with Homogeneity and Size Constraints}
\usage{
cluster_dendrogram(
  dendrogram,
  class_labels,
  hom_thresh,
  min_size,
  allow_flexible_start = TRUE,
  verbose = TRUE,
  dendro_order = NULL,
  sequence_names = NULL,
  data_result = NULL
)
}
\arguments{
\item{dendrogram}{A dendrogram object (typically from \code{\link[stats]{as.dendrogram}}
or \code{\link[stats]{hclust}})}

\item{class_labels}{Character vector of class labels for each dendrogram element,
in dendrogram order (matching the leaf order from \code{\link[stats]{order.dendrogram}})}

\item{hom_thresh}{Numeric value between 0 and 1. Minimum homogeneity threshold.
Homogeneity is calculated as the proportion of the most frequent class:
\code{max(class_counts) / total_elements}}

\item{min_size}{Positive integer. Minimum number of elements required per cluster}

\item{allow_flexible_start}{Logical. If TRUE, allows starting new clusters even when
current element cannot be added to previous cluster. Default is TRUE.}

\item{verbose}{Logical. If TRUE, prints progress messages. Default is TRUE.}

\item{dendro_order}{Integer vector. Dendrogram order from create_dendrogram output.
If provided, enables mapping back to original dataset order. Default is NULL.}

\item{sequence_names}{Character vector. Sequence names in original order.
Used for detailed element assignment. Default is NULL.}

\item{data_result}{List containing 'kmers' and 'metadata' data.frames.
If provided, adds cluster assignments to metadata. Default is NULL.}
}
\value{
A list with the following components:
\describe{
\item{cluster_summary}{Data.frame with cluster summary information containing:
\itemize{
\item cluster_id: Sequential cluster identification number
\item n_elements: Total number of elements in the cluster
\item n_classes: Number of distinct classes present
\item dominant_class: Class with highest frequency
\item homogeneity: Homogeneity value (0-1)
\item class_distribution: Detailed class composition
}
}
\item{element_assignment}{Data.frame mapping each element to its cluster (if dendro_order provided):
\itemize{
\item original_index: Position in original dataset
\item sequence_name: Name of the sequence (if provided)
\item dendro_index: Position in dendrogram order
\item class: Original class label
\item cluster: Assigned cluster ID
\item dominant_class: Dominant class in assigned cluster
\item homogeneity: Homogeneity of assigned cluster
}
}
\item{data_result}{Updated data_result with cluster column added to metadata (if data_result provided)}
\item{cluster_assignment_dendro_order}{Integer vector with cluster IDs in dendrogram order}
\item{cluster_assignment_original_order}{Integer vector with cluster IDs in original order (if dendro_order provided)}
}
}
\description{
Creates clusters from dendrogram leaves following their hierarchical order,
applying homogeneity and minimum size constraints. The function optimizes
cluster formation by prioritizing complete class sequences and maximizing
cluster sizes while maintaining the specified homogeneity threshold.
}
\details{
The algorithm proceeds in the following steps:
\enumerate{
\item \strong{Priority for complete classes:} If a consecutive sequence contains
ALL elements of a particular class, creates a pure cluster (homogeneity = 1.0)
\item \strong{Greedy expansion:} For mixed sequences, builds the largest possible
clusters while maintaining homogeneity >= \code{hom_thresh}
\item \strong{Smart element assignment:} When an element cannot be added to the
previous cluster, starts a new cluster if possible
\item \strong{Constraint enforcement:} Ensures all clusters satisfy both
\code{min_size} and \code{hom_thresh} through iterative merging
\item \strong{Complete assignment:} Guarantees every element is assigned to
exactly one cluster
\item \strong{Order mapping:} If dendro_order is provided, maps cluster assignments
back to original dataset order
\item \strong{Data integration:} If data_result is provided, adds cluster assignments
to the metadata data.frame
}

If it's impossible to satisfy both constraints simultaneously, the function will
attempt to create the best possible clustering and issue a warning.
}
\examples{
\dontrun{
# Create sample data
set.seed(123)
data_matrix <- matrix(rnorm(100 * 10), nrow = 100)
classes <- rep(c("A", "B", "C", "D"), each = 25)

# Create dendrogram
dist_mat <- dist(data_matrix)
hc <- hclust(dist_mat, method = "ward.D2")
dend <- as.dendrogram(hc)

# Prepare class labels in dendrogram order
dend_order <- order.dendrogram(dend)
class_labels <- classes[dend_order]

# Create clusters
cluster_result <- cluster_dendrogram(
  dendrogram = dend,
  class_labels = class_labels,
  hom_thresh = 0.7,
  min_size = 5,
  dendro_order = dend_order
)

# View results
print(cluster_result)
summary(cluster_result)
}

}
